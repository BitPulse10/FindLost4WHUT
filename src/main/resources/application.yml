spring:
  config:
    import:
      - optional:file:.env[.properties]
      - optional:file:docs/dev-ops/environment/.env[.properties]
  servlet:
    multipart:
      # multipart 解析阶段限制（到达 Controller 前生效）
      max-file-size: 10MB
      max-request-size: 50MB
  application:
    name: lostAndFoundForWhut
  profiles:
    active: dev
  # Flyway 数据库迁移配置
  flyway:
    enabled: false
    baseline-on-migrate: true
    locations: classpath:db/migration

app:
  jwt:
    secret: ${APP_JWT_SECRET}
    expiration-ms: 86400000
    refresh-expiration-ms: 604800000
    issuer: lostAndFoundForWhut
  security:
    default-username: admin
    default-password: admin123
    enabled: true # 默认开启；即使显式关闭也不会放开接口鉴权
  upload:
    # 业务层图片大小校验（ImageServiceImpl 使用）
    max-file-size: 5MB # COS 限制 5MB
  rate-limit:
    enabled: true
    default-window-seconds: 60
    default-limit: 120
    default-key-type: USER
    exclude-prefixes:
      - /swagger-ui
      - /v3/api-docs
      - /error
      - /dev-local-images
    rules:
      - path-pattern: /api/auth/login
        window-seconds: 60
        limit: 8
        key-type: IP
      - path-pattern: /api/auth/register/code
        window-seconds: 60
        limit: 3
        key-type: IP
      - path-pattern: /api/auth/password/code
        window-seconds: 60
        limit: 3
        key-type: IP
      - path-pattern: /api/image-search/upload
        window-seconds: 60
        limit: 6
        key-type: USER
      - path-pattern: /api/items/filter
        window-seconds: 60
        limit: 60
        key-type: USER
      - path-pattern: /api/images/upload
        window-seconds: 60
        limit: 12
        key-type: USER

mybatis-plus:
  mapper-locations: classpath*:mapper/**/*.xml
  configuration:
    map-underscore-to-camel-case: true
  global-config:
    db-config:
      logic-delete-field: is_deleted
      logic-delete-value: 1
      logic-not-delete-value: 0

logging:
  level:
    root: info
    org.springdoc: DEBUG
    com.github.xiaoymin: DEBUG
    org.springframework.web: INFO

tencent:
  cos:
    secret-id: ${TENCENT_COS_SECRET_ID}
    secret-key: ${TENCENT_COS_SECRET_KEY}
    bucket-name: ${TENCENT_COS_BUCKET_NAME}
    region: ${TENCENT_COS_REGION}
  cloud:
    secret-id: ${TENCENT_CLOUD_SECRET_ID:}
    secret-key: ${TENCENT_CLOUD_SECRET_KEY:}
    captcha:
      enabled: ${TENCENT_CAPTCHA_ENABLED:false}
      app-id: ${TENCENT_CAPTCHA_APP_ID:0}
      app-secret-key: ${TENCENT_CAPTCHA_APP_SECRET_KEY:}
      type: ${TENCENT_CAPTCHA_TYPE:9}
      region: ${TENCENT_CAPTCHA_REGION:ap-guangzhou}
      allow-disaster-ticket: ${TENCENT_CAPTCHA_ALLOW_DISASTER_TICKET:true}

scheduling:
  task:
    clear-image-search:
      interval: 1h
